<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Bigtable review | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="BigTable review A distributed storage system for managing structed data.
Introduction Dose not support full relational data model
It provides clients with a simple data model which support the dynamic control over data layout and format.
Data is indexed using row and column names that can be arbirtary strings.
Data model sparse, distributed, persistent multi-dimensional sorted map!
map is indexed by a row key, column key and a timestamp.
each value is an uniterpreted array of bytes.">
    <meta name="generator" content="Hugo 0.104.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    
      

    

    
    
    <meta property="og:title" content="Bigtable review" />
<meta property="og:description" content="BigTable review A distributed storage system for managing structed data.
Introduction Dose not support full relational data model
It provides clients with a simple data model which support the dynamic control over data layout and format.
Data is indexed using row and column names that can be arbirtary strings.
Data model sparse, distributed, persistent multi-dimensional sorted map!
map is indexed by a row key, column key and a timestamp.
each value is an uniterpreted array of bytes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/2021-06-17-bigtable/" /><meta property="article:section" content="posts" />

<meta property="article:modified_time" content="2021-10-27T17:47:22+08:00" />

<meta itemprop="name" content="Bigtable review">
<meta itemprop="description" content="BigTable review A distributed storage system for managing structed data.
Introduction Dose not support full relational data model
It provides clients with a simple data model which support the dynamic control over data layout and format.
Data is indexed using row and column names that can be arbirtary strings.
Data model sparse, distributed, persistent multi-dimensional sorted map!
map is indexed by a row key, column key and a timestamp.
each value is an uniterpreted array of bytes.">
<meta itemprop="dateModified" content="2021-10-27T17:47:22+08:00" />
<meta itemprop="wordCount" content="785">
<meta itemprop="keywords" content="emacs,orgmode,hugo,github," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bigtable review"/>
<meta name="twitter:description" content="BigTable review A distributed storage system for managing structed data.
Introduction Dose not support full relational data model
It provides clients with a simple data model which support the dynamic control over data layout and format.
Data is indexed using row and column names that can be arbirtary strings.
Data model sparse, distributed, persistent multi-dimensional sorted map!
map is indexed by a row key, column key and a timestamp.
each value is an uniterpreted array of bytes."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=http://example.org/posts/2021-06-17-bigtable/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=http://example.org/posts/2021-06-17-bigtable/&amp;text=Bigtable%20review" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://example.org/posts/2021-06-17-bigtable/&amp;title=Bigtable%20review" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Bigtable review</h1>
      
      <p class="tracked">
          By <strong>
          
              vintmd
          
          </strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-10-27T17:47:22+08:00">October 27, 2021</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h1 id="bigtable-review">BigTable review</h1>
<p>A distributed storage system for managing structed data.</p>
<h2 id="introduction">Introduction</h2>
<ol>
<li>
<p>Dose not support full relational data model</p>
</li>
<li>
<p>It provides clients with a simple data model which support the dynamic control over data layout and format.</p>
</li>
<li>
<p>Data is indexed using row and column names that can be arbirtary strings.</p>
</li>
</ol>
<h2 id="data-model">Data model</h2>
<p>sparse, distributed, persistent multi-dimensional sorted map!</p>
<p>map is indexed by a row key, column key and a timestamp.</p>
<p>each value is an uniterpreted array of bytes.</p>
<p><img src="https://vintmd.github.io/photo/1624361585121.png" alt="1624361585121"></p>
<h3 id="rows">Rows</h3>
<p>Every read and write under a single row key is atomic, maintains data in lexicographic order by row key.</p>
<p>Each row range is call the tablet, which is unit of distribution and load balancing.</p>
<p><img src="https://vintmd.github.io/photo/1624362432881.png" alt="1624362432881"></p>
<ol>
<li>
<p>row keys are organize in lexicographic order;</p>
</li>
<li>
<p>the range of row is call the tablet;</p>
</li>
<li>
<p>client can store the rows key to same prefix(reverse the url) to achieve the range query.</p>
</li>
</ol>
<h3 id="column-families">Column Families</h3>
<p>intent  the number of distinct column families in a table be small, a tale may have an unbounded number of columns.</p>
<p>a column key is named using the following syntax: family:qualifier.</p>
<h3 id="timestamps">Timestamps</h3>
<p>Contain mult versions of the same data; these versions are indexed by timestamp.</p>
<h2 id="building-blocks">Building blocks</h2>
<p>Uses the distributed GFS to store log and data files.</p>
<h3 id="sstable">SSTable</h3>
<p>SSTable file format is used internally to store data</p>
<p><img src="https://vintmd.github.io/photo/1624414649922.png" alt="1624414649922"></p>
<p>SSTable sparse index in memory, the block write can append file on disk(compressible block). when update the value to update the offset which append to new space. it can support batch create effectiveness.</p>
<p>SSTable support two way to compact</p>
<ol>
<li>
<p>size-tiered: limit the number of sstable in each level</p>
</li>
<li>
<p>leveled: each level sstable size is different, merge the sstables which has the same part of data to higher level, each different part merge is concurrent.</p>
</li>
</ol>
<p>Bigtable relies on a highly-avaiable and persistent distributed lock service called Chubby which uses the paoxs to keep its replicas consistent in the face of failure.</p>
<p>Chubby used in:</p>
<ol>
<li>
<p>ensure at most one master.</p>
</li>
<li>
<p>store the bootstrap location of bigtable data.</p>
</li>
<li>
<p>to discover tablet servers and finalize tablet server death</p>
</li>
<li>
<p>to store bigtable schema infomation(the column family information for each table)</p>
</li>
<li>
<p>to store access control list.</p>
</li>
</ol>
<h2 id="implementation">Implementation</h2>
<p><img src="https://vintmd.github.io/photo/1624448348081.png" alt="1624448348081"></p>
<p>master: assign tablets to tablet server,  detect addition and expiration of tablet server, load balance and GFS GC</p>
<p>tablet server: contain batch of tablets(row range), handle the read and write to the tablets it load.</p>
<p>client: no need to ask the location of tablet server, direct communcate to tablet server to read and write.</p>
<h3 id="table-location">Table Location</h3>
<p><img src="https://vintmd.github.io/photo/1624448788760.png" alt="1624448788760"></p>
<ol>
<li>
<p>chubby file contains the location of root tablet.</p>
</li>
<li>
<p>root tablet contains the location of all tablets in a special metadata table,  the root tablet is just first tablet in the metadata table which never split.</p>
</li>
<li>
<p>client cache  tablet location.</p>
</li>
</ol>
<h3 id="tablet-assignment">Tablet assignment</h3>
<p><img src="https://vintmd.github.io/photo/1624499685243.png" alt="1624499685243"></p>
<p>when start the tablet server it create unique named file in chubby dir, this directory also can used for starting master to detect current alive tablet server.</p>
<p>if the tablet server&rsquo;s chubby session timeout or release the exclusive lock the master can detect it.</p>
<p>the master scan the metadata table to get the each tablet location.</p>
<h3 id="tablet-serving">Tablet Serving</h3>
<p><img src="https://vintmd.github.io/photo/1624499904634.png" alt="1624499904634"></p>
<p>memtable load the sstable files into memory and according to the checkpoint to apply the data.</p>
<p>the tablet log and sstable files are store in gfs.</p>
<p>after the writre has been committed, it contents are inserted into the memetable.</p>
<ul>
<li>it is same to the ofs, memory dir engine&rsquo;s recover.</li>
</ul>
<h3 id="compactions">Compactions</h3>
<p>memtable(size threshold) and sstable files(contains same part) to merge into a new sstable which contains no deletion information or deleted data. The way sames to the LSM tree.</p>
<h2 id="refinements">Refinements</h2>
<h3 id="locality-group">Locality group</h3>
<p>clients can group multi column families together into a local group.</p>
<p>stablet server can load these group sstable into memory(same locality group sstable data is sequence, which can be used by block cache to improve the read efficiency)</p>
<h3 id="compression">Compression</h3>
<p>large content use the compression algorithm or a large locality group to compress.</p>
<h3 id="cache-for-read-performance">Cache for read performance</h3>
<p><img src="https://vintmd.github.io/photo/1624503335639.png" alt="1624503335639"></p>
<ol>
<li>
<p>high level cache scan cache: store the kv pairs</p>
</li>
<li>
<p>low level cache block cache: store the sstable blocks on gfs(sstable is sequnce store new data)</p>
</li>
</ol>
<h3 id="bloom-filters">Bloom filters</h3>
<p>no need to read from all sstables that make up the state of a tablet(whether contains the key).</p>
<h3 id="commit-log-implementation">Commit-log implementation</h3>
<p>give the sequnce number to the log entries to avoid load same row log from different down tablet server.</p>
<h3 id="speeding-up-tablet-recovery">Speeding up tablet recovery</h3>
<p>minor compaction reduce the recovery time.</p>
<h3 id="exploiting-immutability">Exploiting immutability</h3>
<p>sstable is immutable, memtable is mutable.</p>
<p>immutable make the concurrency control over rows very efficienty.</p>
<p>memetable use the copy on write allow reads and writes to processd in parallel.</p>
<h2 id="performance">Performance</h2>
<p>random, sequence write and read, IOPS, qps, throughput, recover time.</p>
<h2 id="real-applications">Real applications</h2>
<p>google Analytics , google earth, facebook. nosql</p>
<h2 id="reference">Reference</h2>
<p>[1] <a href="https://hbase.apache.org/">https://hbase.apache.org/</a></p>
<p>[2] <a href="https://juejin.cn/post/6844904190968332295">https://juejin.cn/post/6844904190968332295</a></p>
<p>[3] <a href="https://zhuanlan.zhihu.com/p/103855686">https://zhuanlan.zhihu.com/p/103855686</a></p>
<p>[4] <a href="https://zhuanlan.zhihu.com/p/181498475">https://zhuanlan.zhihu.com/p/181498475</a></p>
<p>[5] <a href="https://shashankbaravani.medium.com/database-storage-engines-under-the-hood-705418dc0e35">https://shashankbaravani.medium.com/database-storage-engines-under-the-hood-705418dc0e35</a></p>
<p>[6] <a href="https://research.google/pubs/pub27898/">https://research.google/pubs/pub27898/</a></p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/emacs" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">emacs</a>
   </li>
  
   <li class="list">
     <a href="/tags/orgmode" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">orgmode</a>
   </li>
  
   <li class="list">
     <a href="/tags/hugo" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">hugo</a>
   </li>
  
   <li class="list">
     <a href="/tags/github" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">github</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/2021-06-24-chubby/">Chubby review</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2021-06-09-google-file-system/">Google file system review</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2021-06-16-mapreduce/">MR</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2021-06-24-paxos/">Paxos review</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2021-06-18-flink-review/">flink review</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/try/">test the org photo</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/2021-06-17-yarn-process/">yarn process</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy;  My New Hugo Site 2022 
  </a>
    <div>














</div>
  </div>
</footer>

  </body>
</html>
